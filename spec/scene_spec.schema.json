{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://vizcom.local/spec/scene_spec.schema.json",
  "title": "Scene Spec v1.4",
  "type": "object",
  "required": ["mode", "scene", "camera", "composition", "output"],
  "properties": {
    "mode": {
      "type": "string",
      "enum": ["SCENE_ONLY", "PRODUCT_IN_SCENE"]
    },
    "scene": {
      "type": "object",
      "required": ["room_type", "time_of_day", "mood", "scene_dna_preset"],
      "properties": {
        "room_type": { "type": "string" },
        "time_of_day": { "type": "string" },
        "mood": { "type": "string" },
        "scene_dna_preset": { "type": "string" }
      }
    },
    "camera": {
      "type": "object",
      "required": ["pitch", "yaw", "distance", "lens_mm_equiv"],
      "properties": {
        "pitch": { "type": "number" },
        "yaw": { "type": "number" },
        "distance": { "type": "string" },
        "lens_mm_equiv": { "type": "number" }
      }
    },
    "composition": {
      "type": "object",
      "required": ["decor_density", "anchor_zone", "crop_safe"],
      "properties": {
        "decor_density": { "type": "string" },
        "anchor_zone": { "type": "string" },
        "crop_safe": { "type": "string" }
      }
    },
    "output": {
      "type": "object",
      "required": ["master_ratio", "derivatives"],
      "properties": {
        "master_ratio": { "type": "string", "enum": ["1:1", "3:2"] },
        "derivatives": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["16:9", "1:1", "4:5"]
          },
          "minItems": 1,
          "uniqueItems": true
        }
      }
    },
    "product": {
      "type": "object",
      "required": ["placement", "scale_bucket_cm"],
      "properties": {
        "placement": { "type": "string" },
        "scale_bucket_cm": { "type": "string" }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "mode": { "const": "SCENE_ONLY" } },
        "required": ["mode"]
      },
      "then": {
        "not": { "required": ["product"] }
      }
    },
    {
      "if": {
        "properties": { "mode": { "const": "PRODUCT_IN_SCENE" } },
        "required": ["mode"]
      },
      "then": {
        "required": ["product"]
      }
    }
  ]
}
